\chapter{安全分析手法STAMP/STPA}
%岡本さん
\label{chap3}

\section{STAMP（System-Theoretic Accident Model and Processes）の概要}

% pp.6-8の「背景」は（今は）書かないことにする。
STAMP（System-Theoretic Accident Model and Processes）は、システム理論に基づく新しい事故モデル（Accident Model）である。従来の事故モデルが主にコンポーネントの故障（Failure）に焦点を当てているのに対し、STAMPはシステム全体の安全制約（Safety Constraint）とその制御に注目する。

\subsection{STAMPの基本概念}

STAMPの基本要素は以下の3つである： % pp.11

\begin{itemize}
    \item 安全制約：安全が守られるために必要なルール
    \item プロセスモデル：コントローラが認識するコントロール対象の状態
    \item コントロールストラクチャ：コンポーネントとそれらの間の相互作用を示したシステムの設計図
\end{itemize}

STAMPでは、アクシデントを単純なイベントの連鎖ではなく、安全制約が安全制御により適切に守られなかった結果として捉える。

\section{STPA（System-Theoretic Process Analysis）}

STPAは、STAMPに基づくハザード分析手法である。
システムの設計段階や運用開始前に潜在的なハザードを特定し、安全制約を導出するために使用される。

\subsection{STPAの手順}

STPAは以下の4つのステップで構成される(STPA Handbook(2018))：

\begin{enumerate}
    \item[Step 1]: 分析目的の定義
    \item[Step 2]: 制御構造図のモデル化
    \item[Step 3]: 非安全制御動作の識別
    \item[Step 4]: ロスシナリオの識別
\end{enumerate}

以下の各項で、STPAの各ステップについて解説する。

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Step 1: 分析目的の定義}

Step 1「分析目的の定義」では、以下を項目を実施する： %pp.27

\begin{itemize}
    \item ロス（・アクシデント）の識別
    \item システムレベルのハザードの識別
    \item システムレベルの安全制約の識別
    \item ハザードの詳細化（任意）
\end{itemize}

各用語の定義は以下のとおりである。 % pp.28

ロス（loss）は、ステークホルダにとって受容できない何かであり、
例として、人命の喪失、人の負傷、環境汚染、ミッション失敗等が挙げられる。
アクシデント（accident）は、望まれない・計画されていないイベントで、ロスへ至るものである。
例として、自車両が前方障害物に激突等が挙げられる。
以前のSTPAの解説ではアクシデントが識別されていたが、STPA Handbook(2018)では、アクシデントを識別するよう記載されていない。しかし、ロスと合わせてアクシデントを識別することで、ハザードが識別しやすくなるため、ここではアクシデントについても触れることにした。

ハザード（hazard）は、システムの状態または条件の集まりで、最悪の環境条件下で、ロスへ至る蓋然性が高いものである。
なお、ハザードはシステムの状態または条件の集まりであるため、システム境界外を直接扱わない。
例えば、「自車両が（外部環境である）前方障害物に衝突した状態」はハザードではない。
この場合、例えば「（自車両内の前方障害物検出用の）距離センサの値が規定値未満である状態」がハザードとなる。
また、ハザードは必ずしもロスへ至るわけではないことにも注意が必要である。
例えば、距離センサの値が規定値未満であったとしても、前方障害物を回避でき、人命の喪失や負傷へ至らないかもしれない。逆に「自車両が走行中である状態」は、最悪の環境下でロスへ至るが、ロスに至るまでの追加条件が多い（ロスへ至る蓋然性が低い）ため、はざーとしては扱わない。

安全制約（safety constraint）は、システムレベルの条件・動作で、ハザードを防ぐために満たす必要のあるものであり、素朴な安全制約はハザードの裏返しとして定義でき、またハザード発生時にロスを防ぐあるいは最小化する条件・動作としても定義できる。
例えば、ハザード「距離センサの値が規定値未満である状態」を防止するために、「\textcolor{red}{要検討：}自動運転システムは、距離センサの値が規定値未満になったら、自車両を安全に停止させなければならない」といった安全制約が考えられる。

ロス（・アクシデント）、ハザード、安全制約は、番号を付け、ハザードには対応するロスの番号を含める。

\subsubsection{演習:ロス、ハザード、安全制約の識別} % pp.29-35

\textcolor{red}{システムの説明を記述し、図を挿入すること。}

\begin{enumerate}
    \item 上のシステムに対するロス及びアクシデントを識別しなさい。
    （解答例：乗員の死亡・負傷（自車両が前方障害物に衝突））
    \item （i）で識別したロスに対し、ハザードを識別しなさい。
    （解答例：（前方障害物検出用の）距離センサの値が規定値未満）
    \item （ii）で識別したハザードに対し、安全制約を識別しなさい。
    （解答例１：距離センサの値が規定値未満になってはならない。解答例２：自動ブレーキシステムは、距離センサの値が規定値未満にならないよう、ブレーキを指示しなければならない。）
\end{enumerate}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Step 2: 安全制御構造図のモデル化}

Step 2「安全制御構造図のモデル化」では、安全制御構造図（Safety Control Structure Diagram）を構築します。
安全制御構造図（Safety Control Structure Diagram）は、システム内の構成要素（コンポーネント）間の制御関係とフィードバック関係を示すシステムのモデルで、下図(図3.1)のコントロール・ループにより構成されます。
また、コントロール・ループは以下の構成要素により構成されます。

\begin{itemize}
    \item コントローラ：制御する側のコンポーネント
    \item コントロールアルゴリズム：コントローラの判断決定プロセス、コントロールアルゴリズムに基づき、コントロールアクションを指示します。
    \item プロセスモデル：コントローラの内部情報で、判断の際に参照される情報。コントローラが認識する被コントロール・プロセスや外部環境の状態であり、プロセスモデルはフィードバックにより更新されます。
    \item 被コントロール・プロセス：制御される側のコンポーネント
    \item コントロールアクション：被コントロール・プロセスの動作や制約を実行させるための命令・指示。
    \item フィードバック：被コントロール・プロセスや外部環境の情報。
\end{itemize}

\begin{figure}[H]
    \centering
    \includegraphics[width=40mm]{safety_assurance_contents/ch3images/fig-3-2-3-01.png}
    \caption[short]{コントロール・ループ}
\end{figure}

下図（図3.2）は、赤線で囲まれた二つのコントロール・ループにより構成される安全制御構造図の例です。
安全制御構造図では、制御する側を上に、制御される側を下にして記述します。
また図3.2には、アクチュエータとセンサを記載してありますが、比較的新しい文献では、
安全制御構造図を構築する際にはこれらを記載せず、後の分析（Step4）でこれらを追加して分析をするようになっています。

\begin{figure}[H]
    \centering
    \includegraphics[width=40mm]{safety_assurance_contents/ch3images/fig-3-2-3-02.png}
    \caption[short]{例：二つのコントロール・ループにより構成される安全制御構造図}
\end{figure}

安全制御構造図は、物理的設計レベルではなく、機能レベルでのシステムのモデルです。
また、安全制御構造図はモデルですので、安全機構に関係無い機能は省略します。

安全制御構造図を基に分析することで、例えば、
センサが故障した結果、コントローラが間違ったフィードバックを受信して、
コントローラが誤った判断を下すといった事故のシナリオが識別できます。
また、プロセスモデルを考えることで、実際は自車両の前方に歩行者がいるのに、
コントローラ（自動運転車）は歩行者がいないと認識しており、その結果、事故に至るといったシナリオを分析しやすくなります。
さらに、コントローラが判断する際に必要なフィードバックが不足していたといった重大な欠陥を早期に見つけやすくなります。

機械以外にも、人間や組織をコントローラとする場合もあります。
この場合、コントロールアルゴリズムは人間の判断プロセスに、プロセスモデルは人間の認識になります。
また、（分析対象システムの外側である）外部環境からのフィードバックを考えることもあります。
例えば、自動運転車の安全制御構造図では、運転者を最上位のコントローラとし、運転者へのフィードバックとして、
目視情報（自車両の前方に歩行者がいる・いない等）を考えます。
分析の際に、安全制御構造図に人間や組織を含められるため、人間のミスや、他組織からの外圧を含めた事故のシナリオを考えられるようになります。

\subsubsection{演習:安全制御構造図の構築} % pp.44

\textcolor{red}{システムの説明を記述し、図を挿入すること。}

%% pp.52-66の「詳細化によるCSDの構築」を書くか？

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Step 3: 非安全制御動作の識別}

Step 3「非安全制御動作の識別」では、非安全制御動作（UCA: Unsafe Control Action）を識別し、可能であればコントローラ制約を定義します。
UCAは、特定のコンテキストと最悪の環境の下で、ハザードを引き起こす可能性のある制御動作で、
コントローラ制約はUCAを引き起こさないために満たす必要のあるコントローラへの動作（制約）です。

UCAは文章として表すことが多いですが、

「制御動作を出すコントローラ」＋「タイプ」＋「制御動作」＋「コンテキスト」+「ハザード」

の組として考えると、UCAを識別しやすくなります。
このとき、タイプとして以下の4つを用います：
%
\begin{enumerate}
    \item 与えられないとハザード
    \item 与えられるとハザード
    \item 早すぎ、遅すぎ、誤順序でハザード
    \item 早すぎる停止、長すぎる適用でハザード
\end{enumerate}
また、コンテキストは制御動作が非安全となる条件を表します。

UCAの例として、「運転者からのブレーキ指示があり、タイヤがロックしていないにもかかわらず、ABSコントローラがブレーキ圧力発生を指示しないため，前方障害物との距離が規定値未満になる．(H3)」を考えます。
コントローラ「ABSコントローラ」に対するこのUCA対するコントローラ制約として、このUCAを否定形である
「運転者からのブレーキ指示があり、タイヤがロックしていないときには、ABSコントローラがブレーキ圧力発生を指示する。」
を考えることができます。
このとき、このUCAは以下のように分解されます：
%
\begin{itemize}
    \item 制御動作を出すコントローラ：ABSコントローラ
    \item タイプ：与えない
    \item 制御動作：ブレーキ圧力発生
    \item コンテキスト：運転手からのブレーキ指示があり、タイヤがロックしていない
\end{itemize}
%
制御動作を出すコントローラ、タイプ、制御動作、ハザードは既に識別されているため、それらを組み合わせて考えることで、網羅的な分析が可能になります。
しがって、コンテキストを識別することが最も重要となります。
このとき、制御動作を出すコントローラの入力に着目すると、コンテキストが考えやすくなります。
また識別したUCAに番号を付け、以下のような表形式で表すと可読性が高まり、後の分析が容易になります。
%
\begin{figure}[H]
    \centering
    \includegraphics[width=40mm]{safety_assurance_contents/ch3images/fig-3-2-3-03.png}
    \caption[short]{例：UCAの表}
\end{figure}

コンテキストが無いにもかかわらずUCAとなる場合や、同じコンテキストの下で与えても、
与えなくてもUCAとなる場合には、その制御動作は設計には問題があると考えられます。

\subsubsection{演習:UCAの識別} % pp.74,75

\textcolor{red}{システムの説明を記述し、図を挿入すること。}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Step 4: ロスシナリオの識別}

\textcolor{red}{ここから再開 2024-09-17}

Step 4「ロスシナリオの識別」では、Step 3で識別したUCAに対してロスシナリオを識別します。
ロスシナリオ（Loss Scenario）は、UCA、ひいてはハザードへ至る要因を記述したシナリオです。
ロスシナリオの中で具体的要因を識別するので、アクチュエータとセンサを入れたコントロール・ループを基に分析します。

大きく分けて、以下の2種類のロスシナリオを考えます：
%
\begin{itemize}
    \item UCAへ至るシナリオ
    \item 制御動作の不実行・不適切な実行を表すシナリオ
\end{itemize}
%
「UCAへ至るシナリオ」では、図3.2.5.1の右上部分に着目し、なぜUCAが発生したのかを考えます。
UCAが発生する主な要因としては、コントローラの非安全な動作や、不適切なフィードバック・（他コントローラ等からの）入力が考えられます。 % 84ページ「コントロールループで安全制約を破られる要因の例2」の図を入れるか？
また「制御動作の不実行・不適切な実行を表すシナリオ」では、図3.2.5.1の左下部分に着目し、
なぜ制御動作は不適切に実行されたのか、なぜ制御動作は実行されなかったのかを考えます。
\textcolor{red}{さらに、86ページの説明と図を追加する。}
%
\begin{figure}[H]
    \centering
    \includegraphics[width=40mm]{safety_assurance_contents/ch3images/fig-3-2-5-01.png}
    \caption[short]{考えるべきロスシナリオ}
\end{figure}

\textcolor{red}{（ハザードからロスシナリオまで一貫性・妥当性のある例に変更すること！）}
UCA「運転者からのブレーキ指示があり、タイヤがロックしていないにもかかわらず、ABSコントローラがブレーキ圧力発生を指示しないため，前方障害物との距離が規定値未満になる。」を考えます。
このUCAに対するロスシナリオ、特にUCAへ至るシナリオの例としては、
「センサからのフィードバックが間違っていたため、ABSコントローラがタイヤがロックしていないと誤認識してしまい、ABSコントローラがブレーキ圧力発生を指示しない。」が考えられます。
このように現実とプロセスモデル（コントローラの認識）が異なる状況は、プロセスモデルの不一致と呼ばれ、ロスシナリオを識別する際に、しばしば登場します。
また、制御動作の不実行・不適切な実行を表すシナリオの例としては、
「アクチュエータが故障していたため、ABSコントローラがブレーキ圧力発生を指示したにもかかわらず、アクチュエータがブレーキ圧力を発生しないため、自車両が減速せず障害物に衝突する。」が考えられます。



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{CAST（Causal Analysis based on System Theory）}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

CASTは、STAMPに基づく事故分析手法です。実際に発生したアクシデントのシナリオを識別し、システムの安全制御構造がなぜ機能しなかったかを分析します。

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{CASTの目的}

CASTの主な目的は以下の通りです：

\begin{itemize}
    \item 事故調査の際に問われるべき質問を特定する
    \item 事故がなぜ起こったのかを明らかにする
    \item 責任の所在を明らかにするのではなく、システムの改善点を見出す
\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{CASTの手順}

CASTは以下の手順で実施されます：

\begin{enumerate}
    \item 基本情報の収集
    \item 安全コントロールストラクチャーのモデル化
    \item 損失における各コンポーネントの分析
    \item コントロールストラクチャーの欠陥の識別
    \item 改善プログラムの作成
\end{enumerate}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{事例研究: 自動運転システムへのSTPAの適用}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

ここでは、自動運転システムにSTPAを適用する例を示します。

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Step 1: 分析目的の定義}

\begin{itemize}
    \item ロス: 人命の損失、車両の損傷
    \item ハザード: 自車両と他の物体（車両、歩行者、障害物など）との距離が安全距離未満になる
    \item 安全制約: 自車両は常に他の物体との安全距離を維持しなければならない
\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Step 2: 制御構造図のモデル化}

% ここに制御構造図を挿入
\textcolor{red}{[自動運転システムの制御構造図を挿入]}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Step 3: 非安全制御動作の識別}

UCAの例：
\begin{itemize}
    \item UCA1: 前方に障害物があるにもかかわらず、自動運転システムがブレーキを適用しない
    \item UCA2: 安全な状況下で自動運転システムが不必要にブレーキを適用する
\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Step 4: ロスシナリオの識別}

ロスシナリオの例：
\begin{itemize}
    \item LS1: センサーの故障により、自動運転システムが前方の障害物を検知できず、ブレーキを適用しない
    \item LS2: ソフトウェアのバグにより、自動運転システムが安全な状況を危険と誤認識し、不必要にブレーキを適用する
\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{事例研究: 鉄道システム事故へのCASTの適用}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

ここでは、実際の鉄道システム事故にCASTを適用する例を示します。

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{事故概要}

2019年6月1日、横浜シーサイドラインの無人自動運転列車が逆走し、終端の車止めに衝突した事故を分析します。

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{基本情報の収集}

\begin{itemize}
    \item 事故日時: 2019年6月1日 20時15分頃
    \item 場所: 新杉田駅
    \item 結果: 乗客25名中17名が負傷
    \item システム: 自動列車運転システム（ATO）、自動列車制御システム（ATC）
\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{安全コントロールストラクチャーのモデル化}

% ここに安全コントロールストラクチャーの図を挿入
\textcolor{red}{[鉄道システムの安全コントロールストラクチャー図を挿入]}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{各コンポーネントの分析}

例: ATOシステムの分析
\begin{itemize}
    \item 責任: 列車の自動運転制御
    \item 不適切な制御行動: 逆方向への出発指示
    \item 誤ったプロセスモデル: 正しい進行方向の認識の欠如
    \item コンテキスト: システムの設計上の欠陥
\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{改善提案}

\begin{itemize}
    \item ATOシステムの進行方向認識機能の強化
    \item ATCシステムによる逆走検知機能の改善
    \item 人間のオペレーターによるバックアップ体制の強化
\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{まとめ}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

STAMP/STPA及びCASTは、現代の複雑なシステムの安全性分析に適した手法です。これらの手法を用いることで、以下のような利点が得られます：

\begin{itemize}
    \item システム全体の安全性を包括的に分析できる
    \item 人間要因を含むシステムの相互作用を考慮できる
    \item 事故の根本原因だけでなく、システムの改善点を特定できる
    \item 設計段階から運用段階まで、システムのライフサイクル全体にわたって適用できる
\end{itemize}

これらの手法を効果的に活用することで、より安全で信頼性の高いシステムの開発と運用が可能になります。

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{参考文献}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{itemize}
    \item Engineering a Safer World, 2012
    \item STPA Handbook, 2018
    \item はじめてのSTAMP/STPA, 2016
    \item はじめてのSTAMP/STPA(実践編), 2017
    \item はじめてのSTAMP/STPA(活用編), 2018
    \item STAMPガイドブック ～システム思考による安全分析～, 2019
    \item STAMP Workbench
\end{itemize}